<div class="inventory-container">
  
  <div class="header">
    <h1>üì¶ Inventario</h1>
    <a routerLink="/" class="back-link">‚¨Ö Ir a Caja</a>
  </div>

  @if (!showForm) {
    <div class="actions-bar">
      <button class="btn-create" (click)="openCreateForm()">‚ûï Nuevo Producto</button>
    </div>

    <table class="product-table">
      <thead>
        <tr>
          <th>Producto</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (product of products; track product._id) {
          <tr>
            <td><strong>{{ product.name }}</strong></td>
            <td>${{ product.price | number:'1.2-2' }}</td>
            <td>
              <span [class.low-stock]="product.stock < 10" [class.no-stock]="product.stock === 0">
                {{ product.stock }}
              </span>
            </td>
            <td class="actions-cell">
              <button class="btn-edit" (click)="openEditForm(product)">‚úèÔ∏è</button>
              <button class="btn-delete" (click)="deleteProduct(product._id || '')">üóëÔ∏è</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  }

  @if (showForm) {
    <div class="form-card">
      <h2>{{ isEditing ? '‚úèÔ∏è Editar Producto' : '‚ú® Nuevo Producto' }}</h2>
      
      <form [formGroup]="productForm" (ngSubmit)="saveProduct()">
        
        <div class="form-group">
          <label>Nombre del Producto *</label>
          <input 
            formControlName="name" 
            type="text" 
            placeholder="Ej. Latte Vainilla"
            [class.input-error]="hasError('name', 'required') || hasError('name', 'minlength')"
          >
          @if (hasError('name', 'required')) {
            <small class="error-msg">‚ö†Ô∏è El nombre es obligatorio.</small>
          }
          @if (hasError('name', 'minlength')) {
            <small class="error-msg">‚ö†Ô∏è M√≠nimo 3 letras.</small>
          }
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Precio ($) *</label>
            <input 
              formControlName="price" 
              type="number" 
              placeholder="0.00"
              [class.input-error]="hasError('price', 'required') || hasError('price', 'min')"
            >
            @if (hasError('price', 'required')) {
              <small class="error-msg">‚ö†Ô∏è Precio requerido.</small>
            }
            @if (hasError('price', 'min')) {
              <small class="error-msg">‚ö†Ô∏è M√≠nimo $0.50.</small>
            }
          </div>

          <div class="form-group">
            <label>Stock Inicial *</label>
            <input 
              formControlName="stock" 
              type="number"
              [class.input-error]="hasError('stock', 'required') || hasError('stock', 'min')"
            >
            @if (hasError('stock', 'min')) {
              <small class="error-msg">‚ö†Ô∏è No puede ser negativo.</small>
            }
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn-cancel" (click)="closeForm()">Cancelar</button>
          
          <button 
            type="submit" 
            class="btn-save" 
            [disabled]="productForm.invalid"
            [title]="productForm.invalid ? 'Corrige los errores' : 'Guardar cambios'"
          >
            {{ isEditing ? 'Actualizar' : 'Guardar' }}
          </button>
        </div>

      </form>
    </div>
  }
</div>